<template>
  <Window title="Weather in your city" width="400" height="150" margined v-on:close="exit">
    <Box padded>
      <Box horizontal padded>
        <TextInput v-model="query" stretchy /> 
        <Button :enabled="!!query" @click="showWeather">Search</Button>
      </Box>
      <Separator horizontal />
      <Group margined>
        <Box padded>
          <Text v-if="error">There is no such city in the database</Text>
          <Box v-if="!!city">
            <Box padded horizontal>
              <Text stretch>{{city}}, {{country}}</Text>
              <Text>{{temp}}&deg;C</Text>
            </Box>
            <Text>{{weatherDescription}}</Text>
            <Separator horizontal />
            <Box padded horizonatal>
              <Text stretchy>Min: {{tempMin}}&deg;F</Text>
              <Text stretchy>Max: {{tempMax}}&deg;F</Text>
              <Text stretch>Humidity: {{humidity}}%</Text>
            </Box>
          </Box>
        </Box>
      </Group>
    </Box>
  </Window>
</template>

<script>
import axios from "axios";
axios.defaults.baseURL = "http://api.openweathermap.org/data/2.5";
const apiKey = "1fb4646cd895573492012bda0f578e68";
export default {
  data() {
    return {
      query: "",
      error: false,
      city: "",
      country: "",
      weatherDescription: "",
      temp: null,
      tempMin: null,
      tempMax: null,
      humidity: null
    };
  },
  methods: {
    exit() {
      this.$exit();
    },
    showWeather() {
      axios
        .get("/weather?q=${this.query}&units=imperial&appid=${apiKey}")
        .then(response => {
          this.city = response.data.name;
          this.country = response.data.sys.country;
          this.weatherDescription = response.data.weather[0].description;
          this.temp = response.data.main.temp;
          this.tempMin = response.data.main.temp_min;
          this.tempMax = resposne.data.main.temp_max;
          this.humidity = response.data.main.humidity;
          this.error = false;
        })
        .catch(() => {
          this.error = true;
          this.city = "";
        });
    }
  }
};
</script>
